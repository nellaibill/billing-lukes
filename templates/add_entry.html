<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Add Billing Entry</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 2em; background: #f8f9fa; }
        .container { max-width: 700px; margin: 0 auto; background: #fff; padding: 2em 2.5em 2em 2.5em; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
        h1 { margin-bottom: 0.5em; }
        form { width: 100%; }
        label { display: block; margin-top: 1em; font-weight: 500; }
        input, select { width: 100%; padding: 8px; margin-top: 4px; border: 1px solid #ccc; border-radius: 4px; }
        button, .menu a { background: #007bff; color: #fff; border: none; border-radius: 4px; padding: 8px 16px; cursor: pointer; font-size: 1em; }
        button:hover, .menu a:hover { background: #0056b3; }
        .item-row { display: flex; gap: 1em; margin-bottom: 0.5em; }
        .item-row > * { flex: 1; }
        .remove-btn { flex: 0 0 auto; background: #dc3545; color: #fff; padding: 8px 10px; }
        .remove-btn:hover { background: #a71d2a; }
        .menu { background: #343a40; padding: 0.7em 2em; border-radius: 8px 8px 0 0; margin-bottom: 2em; display: flex; gap: 1.5em; }
        .menu a { color: #fff; text-decoration: none; font-weight: 500; transition: background 0.2s; padding: 6px 14px; }
        .menu a.active, .menu a:focus { background: #007bff; border-radius: 4px; }
        .form-actions { margin-top: 1.5em; display: flex; gap: 1em; }
        @media (max-width: 700px) {
            .container { padding: 1em; }
            .item-row { flex-direction: column; gap: 0.5em; }
        }
    </style>
    <script>
        function addItemRow() {
            const template = document.getElementById('item-template');
            const clone = template.content.cloneNode(true);
            document.getElementById('items').appendChild(clone);
            updateTotals();
        }
        function updateTotals() {
            const amounts = document.querySelectorAll('input[name="amount"]');
            let total = 0;
            let count = 0;
            amounts.forEach(function(input) {
                if (input.value) {
                    total += parseFloat(input.value);
                    count++;
                }
            });
            document.getElementById('total-items').textContent = count;
            document.getElementById('total-amount').textContent = total.toFixed(2);
        }
        window.onload = function() {
            document.getElementById('add-item-btn').onclick = addItemRow;
            document.getElementById('items').addEventListener('input', function(e) {
                if (e.target.name === 'amount') updateTotals();
            });
            updateTotals();
        };
    </script>
</head>
<body>
    <div class="container">
        <nav class="menu">
            <a href="{{ url_for('index') }}" {% if request.endpoint == 'index' %}class="active"{% endif %}>Home</a>
            <a href="{{ url_for('add_entry') }}" {% if request.endpoint == 'add_entry' %}class="active"{% endif %}>Add Entry</a>
            <a href="{{ url_for('masters') }}" {% if request.endpoint == 'masters' %}class="active"{% endif %}>Manage Masters</a>
        </nav>
        <h1>Add Billing Entry</h1>
        <form method="post">
            <div class="item-row" style="margin-bottom: 1.5em;">
                <input type="text" name="op_bill_no" placeholder="OP Bill No" required>
                <input type="text" name="patient_name" placeholder="Patient Name" required>
                <input type="date" name="date" value="{{ datetime.utcnow().strftime('%Y-%m-%d') }}" required readonly style="background:#e9ecef;">
            </div>
            <hr>
            <h3>Items</h3>
            <div id="items">
                <div class="item-row">
                    <select name="category" required>
                        {% for cat in categories %}
                        <option value="{{ cat.id }}">{{ cat.name }}</option>
                        {% endfor %}
                    </select>
                    <input type="number" name="amount" step="0.01" required placeholder="Amount" oninput="updateTotals()">
                    <select name="payment_type" required>
                        {% for pt in payment_types %}
                        <option value="{{ pt.id }}">{{ pt.name }}</option>
                        {% endfor %}
                    </select>
                    <button type="button" class="remove-btn" onclick="this.parentNode.remove(); updateTotals();">Remove</button>
                </div>
            </div>
            <div style="margin-top:1em; font-weight:500;">
                Total Items: <span id="total-items">0</span> &nbsp; | &nbsp; Total Amount: <span id="total-amount">0.00</span>
            </div>
            <button type="button" id="add-item-btn">Add Item</button>
            <div class="form-actions">
                <button type="submit">Save</button>
                <a href="{{ url_for('index') }}" style="background:#6c757d;">Cancel</a>
            </div>
        </form>
    </div>
    <template id="item-template">
        <div class="item-row">
            <select name="category" required>
                {% for cat in categories %}
                <option value="{{ cat.id }}">{{ cat.name }}</option>
                {% endfor %}
            </select>
            <input type="number" name="amount" step="0.01" required placeholder="Amount">
            <select name="payment_type" required>
                {% for pt in payment_types %}
                <option value="{{ pt.id }}">{{ pt.name }}</option>
                {% endfor %}
            </select>
            <button type="button" class="remove-btn" onclick="this.parentNode.remove()">Remove</button>
        </div>
    </template>
</body>
</html>
